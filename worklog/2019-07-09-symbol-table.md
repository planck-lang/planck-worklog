# 20190709

## 심볼 테이블

플랑크는 심볼 테이블에 변수값을 저장한다. 심볼 테이블 자체가 일종의 무한 레지스터 역할을 한다. 리얼 하드웨어는 한정된 레지스터를 가지고 있다. 예를 들어 어떤 하드웨어는 변수값등을 처리하는데 쓸 수 있는 범용 레지스터를 최대 8개 가지고 있다고 하자. 그러면 8개가 넘어가는 변수는 레지스터가 아니라 스택이나 메모리에 저장해야 한다.

플랑크는 가상 머신을 쓰는 인터프리터 언어다. 그래서 가상 머신의 사양을 마음대로 만들 수 있다. 나는 무한 레지스터 머신으로 플랑크 가상 머신을 만들었고 레지스터가 무한이기 때문에 따로 심볼 테이블에 심볼의 값이 있는 메모리 주소 혹은 레지스터 인덱스를 관리할 필요가 없다. 그냥 심볼 테이블 자체를 레지스터로 간주하면 된다. 레지스터 인덱스는 심볼 테이블 인덱스와 동일하다.

현시점에서 심볼 테이블에 접근하는 opcode는 store, load, decl 세 개다. decl은 심볼 테이블에 최초 심볼을 등록하는 opcode다. store는 심볼 테이블의 값을 바꾸는 것이고 load는 심볼 테이블에서 값을 읽어서 가상 머신 스택에 push하는 opcode다.

```
num_t n = 3 * 5;
```

위 코드는 아래 opcode로 번역한다.

```
push 3
push 5
mul
decl n
```

마지막 명령어 "decl n"은 일종의 의사 코드다. 실제로는 바이너리 파일 어딘가에 심볼 테이블 덤프 데이터가 있고, 변수 n에 대한 심볼 테이블 인덱스가 decl opcode의 파라메터로 들어가야 한다. 만약 변수 n의 심볼 테이블 인덱스가 1이라면" decl 1" 같은 형태로 바이너리 코드를 만든다.